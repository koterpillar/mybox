#!/usr/bin/env bash

set -euo pipefail

ISORT_ARGS=(--check)
BLACK_ARGS=(--check)
if [ "${1-}" == "--format" ]
then
    ISORT_ARGS=()
    BLACK_ARGS=()
fi

DIR=$(cd "$(dirname "$0")" && pwd)

# shellcheck disable=SC2046
shellcheck $(grep -lER '^#!.+bash' "$DIR")

PYTHON=("${DIR}/mybox" "${DIR}/tests")

poetry run isort "${ISORT_ARGS[@]}" "${PYTHON[@]}"
poetry run black "${BLACK_ARGS[@]}" "${PYTHON[@]}"
poetry run mypy "${PYTHON[@]}"
poetry run pylint "${PYTHON[@]}"
poetry run fawltydeps
